---
title:  "[네트워크] CSRF"
categories:
  - network
tags:
  - [CS, Network]
date: 2023-01-31
last_modified_at: 2023-01-31
permalink: /network/csrf/
---

CSRF (Cross-site request forgery, 사이트 간 요청 위조)
* 웹 보안 취약점 중 하나로, 사용자가 자신의 의지와 무관하게 공격자가 의도한 행위(데이터의 등록, 수정, 삭제 등)를 특정 웹 사이트에 요청하게 하는 공격을 말한다.

CSRF 동작 원리

CSRF가 성공하려면, 아래 3가지 조건이 만족해야 한다.
1. 사용자는 보안이 취약한 서버로부터 이미 로그인되어 있는 상태여야 한다.
2. 쿠키 기반의 서버 세션 정보를 획득할 수 있어야 한다.
3. 공격자는 서버를 공격하기 위한 요청 방법에 대해 미리 파악하고 있어야 한다. 예상하지 못한 요청 매개변수가 있다면 불가능하다.

이 조건이 만족되면 다음과 같은 과정을 통해 CSRF 공격이 가능해진다.
1. 사용자는 보안이 취약한 서버에 로그인한다.
2. 서버에 저장된 세션 정보를 사용할 수 있는 Session ID가 사용자의 브라우저 쿠키에 저장된다.
3. 공격자는 사용자가 악성 스크립트 페이지를 누르도록 유도한다.

악성 스크립트 페이지를 누르도록 유도하는 방식

* 게시판이 있는 웹 사이트에 악성 스크립트를 게시글로 작성하여 사용자들이 클릭하도록 유도
* 메일 등으로 악성 스크립트를 직접 전달하거나, 악성 스크립트가 적힌 페이지 링크 전달

4. 사용자가 악성 스크립트가 작성된 페이지 접근 시 웹 브라우저에 의해 쿠키에 저장된 Session ID와 함께 서버로 요청된다.
5. 서버는 쿠키가 담긴 Session ID를 통해 해당 요청이 인증된 사용자로부터 온 것으로 판단하고 처리한다.

CSRF 방어 기법

Referer 체크
* HTTP 헤더에 있는 Referer로 해당 요청이 요청된 페이지의 정보를 확인하는 방법
* 간단하여 소규모 웹 사이트에서 주로 사용되는 방법이다. 하지만 해당 정보는 Paros나 Zap, fiddler 같은 프로그램으로 조작이 가능하다.

GET / POST 요청 구분
* Img 태그 등의 경우 GET 요청으로, Form 태그로 값을 받을 경우 POST를 이용하여 요청을 구분해 준다.

Tocken 사용
* 서버에서 hash로 암호화된 tocken을 발급, 사용자는 매 요청마다 tocken을 함께 보내어 서버의 검증을 거쳐야 한다.

추가 인증 수단 사용 (CAPCHA)
* 추가 인증 수단을 거쳐 만약 테스트를 통과 못할 시, 해당 요청 자체를 거부하는 방법이다.

