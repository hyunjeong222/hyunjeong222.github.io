---
title:  "[네트워크] XSS"
categories:
  - network
tags:
  - [CS, Network]
date: 2023-01-21
last_modified_at: 2023-01-21
permalink: /algorithm/xss/
---

XSS(Cross-Site Scripting)
* 관리자가 아닌 권한이 없는 사용자가 웹 사이트에 스크립트를 삽입하는 공격 기법

지속성 혹은 저장형 XSS(Persistent XSS or Stored XSS)
* Stored XSS은 웹 애플리케이션 취약점이 있는 웹 서버에 악성 스크립트를 영속적으로 저장해 놓는 방법이다.
* 악성 스크립트가 데이터베이스에 저장이 되어 지속적으로 공격한다고 하여 Persistent XSS라고 부르며, 데이터베이스에 저장이 되므로 Stored XSS 공격이라고 부르기도 한다.
* 한 번의 공격으로 악성 스크립트를 삽입하여 수많은 피해를 입힐 수 있다.

[공격 순서]
1. 공격자는 웹 사이트의 게시판, 사용자 프로필 및 코멘트 필드 등의 입력 form을 통해 POST로 악성 스크립트를 전달하면 서버는 해당 내용을 DB에 저장한다.
2. 희생자가 해당 페이지를 요청하면
3. 서버는 저장된 악성 스크립트를 포함시킨 페이지를 사용자에게 전달하게 되고
4. 희생자 브라우저에서 스크립트가 실행되어 XSS 공격이 수행된다.

반사형 XSS 공격(Reflected XSS)
* Reflected XSS는 웹 애플리케이션의 지정된 파라미터를 사용할 때 발생하는 취약점을 이용하는 공격을 말한다.
* 검색 결과, 에러 메시지 등 서버가 외부에서 입력 값을 받아 브라우저에게 응답할 때 파라미터에 삽입된 악성 스크립트를 사용자에게 그대로 전달하면서 발생한다.

[공격 순서]
1. 공격자는 파라미터에 악성 스크립트를 포함시킨 URL(링크, 악성 메일 등)을 작성하여 희생자에게 전달한다.
2. 희생자는 전달받은 URL을 서버에 요청한다.
3. 웹 서버의 응답 페이지에 악성 스크립트가 포함되어 희생자에게 전달되고
4. 희생자의 브라우저는 응답 페이지 내의 악성 스크립트를 실행하여 XSS 공격이 수행된다.

문서 객체 모델-기반 XSS(DOM-based XSS)
* DOM based XSS는 악의적인 스크립트가 포함된 URL을 사용자가 요청하게 되어 브라우저를 해석하는 단계에서 발생하는 공격을 말한다.
* 악의적인 스크립트로 인해 클라이언트 측 코드가 원래 의도와는 다르게 실행된다.
* DOM based XSS 공격은 다른 XSS 공격과 다르게 서버 측에서 탐지가 어렵다.

[공격 순서]
1. 공격자는 파라미터에 악성 스크립트를 포함시킨 URL(링크, 악성 메일 등)을 작성하여 희생자에게 전달한다.
2. 희생자의 브라우저는 렌더링 중 HTML을 페이지에 추가하기 위해 innerHTML로 다뤄지는 사용자 입력을 구문 분석하고 페이지를 동적으로 생성한다.
3. DOM-based XSS은 이러한 과정에서 악성 스크립트가 포함된 사용자 입력이 페이지의 HTML 태그에 추가되어 실행되는 공격이다.
* 서버의 응답 내에는 악성 스크립트가 포함되지 않지만, 브라우저에서 응답 페이지 내 정상적인 스크립트가 실행되며 악성 스크립트가 추가되어 실행되는 것이다.

보편 XSS(Universal XSS)
* Universal XSS는 클라이언트 측 취약점으로 브라우저 안에 악성 스크립트를 실행하는 또 다른 방법이다.
* 경우에 따라 SOP(Same-Origin Policy, 동일-출처 정책)의 제약도 피해 간다.
* Universal XSS 공격은 기능성 구조의 한 수준 위로 올라가서, 브라우저 자체의 취약점이나 확장 기능 또는 플러그인의 취약점을 악용한다.

XSS 공격 위험성

쿠키 정보 및 세션 획득
* XSS 공격을 통해 페이지 사용자의 세션 ID를 획득해 공격자가 불법적으로 정상 사용자인 척 가장 가능할 수 있다.

시스템 관리자 권한 획득
* 아직 패치되지 않은 취약점에 대한 공격 코드가 실행되도록 하여 사용자의 시스템을 통제할 수 있다.

악성코드 다운로드
* 사용자가 악성 스크립트 URL을 클릭하도록 유도하여 악성 프로그램을 다운로드하는 사이트로 리다이렉트하거나 트로이 목마 프로그램을 다운로드하도록 유도할 수 있다.

거짓 페이지 노출
* 원래 페이지 일부를 변조해 거짓 페이지를 노출할 수 있어, 이를 통해 개인정보 유출 등의 위험이 존재한다.

XSS 공격 대응 방안

입출력 값 검증
* 사용자가 입력한 값을 그대로 출력할 때 검증이 필요하다. XSS Cheat Sheet에 대한 필터 목록을 만들어 모든 Cheat Sheet에 대한 대응이 가능하도록 해야 하며, XSS에 대한 필터링을 적용한 뒤 직접 테스트하여 스크립트가 실행되는지 모의 해킹을 해보는 것도 좋은 방법이다.

XSS 방어 라이브러리, 브라우저 확장 앱 사용
* 여러 회사에서 제공하는 Anti XSS 라이브러리를 사용하여 XSS를 방어할 수 있다.
* XSS 라이브러리를 사용하는 것은 서버 단에서 개발자가 추가하는 것이고, 사용자들이 각자 본인의 브라우저에서 악의적인 스크립트가 실행되지 않도록 방어하는 것이 중요하다.

웹 방화벽 사용
* 웹 방화벽은 웹 공격에 특화되어있기 때문에 XSS 공격을 방어하기 위함만이 아니라 각종 Injection 공격을 효과적으로 방어할 수 있다.

쿠키 HttpOnly 옵션 활성화
* HttpOnly 옵션을 활성화하면 악의적인 클라이언트가 쿠키에 저장된 정보(Session Id, token)에 접근하는 것을 차단하기 대문에, 스크립트를 통해 쿠키에 접근하여 Session Hijacking에 취약해지는 것을 방지할 수 있다.
* 또한, LocalStorage에 세션 ID와 같은 민감한 정보를 저장하지 않는 것이 중요하다.

XSS 특수문자 치환
* XSS 공격 방지를 위해 XSS 공격에서 사용하는 &, <, >, “, ‘, /과 같은 특수문자를 치환시키는 과정이 필요하다.
